[TOC]





# STM32学习



## 前面的话

因为是第一次培训，你们也没有准备，就从下次开始：



**培训前：**

1. 了解下次培训内容，做好预习（因为我们只是做介绍、便于你们学习，真正要把这个内容讲透，还是有点难度的）
2. 过程适当做笔记:pen: 



**结束培训：**

1. 完成培训布置的作业:book:，下次培训验收
2. 期间完善笔记:pen:，下次培训检查



## 了解你学习的是什么

1. 了解**单片机**是什么
2. 了解**stm32**是什么
3. 了解stm32种类
4. 了解什么是**jlink** 

初学建议学习**stm32f103c8t6** 

**自行了解**stm32的学习路线，以下的只是我们给出的建议，不必全听



### 为什么是stm32

假如你会使用8051 ， 会写C语言，那么STM32本身并不需要刻意的学习。

你要考虑的是， 我可以用STM32实现什么？

为什么使用STM32而不是8051？是因为51的频率太低，无法满足计算需求？是51的管脚太少，无法满足众多外设的IO？是51的功耗太大，电池挺不住？是51的功能太弱，而你要使用SPI、I2C、ADC、DMA？是51的内存太小而你要存储的东西太多？

当你需要使用STM32某些功能，而51实现不了的时候， 那STM32自然不需要学习，**你会直接去寻找STM32某方面的使用方法**。比如要用SPI协议的网卡、要使用串口通信、要使用RTOS等等。



## 必备的东西



### 软件

下载**keil5（MDK版）**，不是C51版本，注意不要下载错了。

用注册机（也就是每个软件安装教程都会用来破解的一个软件，安装的时候就知道了）破解的时候，注意要以**管理员身份运行**注册机，**下载前注意要关闭杀毒软件和win10自带的实时保护** 

> 下面有连接

#### stm32芯片包

安装**芯片包**，这可以在stm32官网上找得到（需要翻墙），上网搜索一下芯片包怎么安装就好了，（当然视频上也会教）

> 下面有连接

### 驱动

- **jlink驱动安装**
- **串口ch340驱动安装**

> 下面有连接

### 工具（自备）

1. stm32开发板子，自己想办法，借也可以，买也行，型号随意 （这个肯定就是必备的了）
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-2021111120162safaa2.jpg" alt="image-20211111201627002" style="zoom:50%;" />
2. jlink、stlink、dap等仿真器
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20211111201720asf584.png" alt="image-20211111201720584" style="zoom:50%;" />
3. TTL转串口模块
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-202111112018s03751.png" alt="image-20211111201803751" style="zoom:50%;" />
4. 面包板、直插的led、杜邦线（公对公，公对母，母对母）、所需的一些模块等等（可选）
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20211111201af852329.png" alt="image-20211111201852329" style="zoom: 67%;" />
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-2021111asf201958822.png" alt="image-20211111201958822" style="zoom:50%;" />
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-2021111120afs2040623.png" alt="image-20211111202040623" style="zoom: 33%;" />
   <img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-202111112af02126094.png" alt="image-20211111202126094" style="zoom:50%;" />





### :star:工程模板！

stm32的工程模板不要根据视频和书本的教程来，建议直接上网搜索“**stm32 新建工程模板**”，网上资料非常详细

尽量在**stm官网**上下载 stm32**标准库** 的资料，然后根据网上的教程一步步来

！！有一个通用的工程模板**非常重要**，必须保证工程模板不会出错，不然后面会非常难受

**强烈建议自己创建工程模板**



### 坚持

能坚持下来才算成功啊，什么都说难，什都说没有时间，这样怎么可能坚持得下来

不过，你首先要对这个东西有兴趣才能坚持下来，你要了解这个东西，才能有兴趣



## 怎么学习

两大stm32开发教育机构（算是吧），“**正点原子**”，“**野火**”

- 野火官网：https://www.firebbs.cn/ （还有一个叫[**野火大学堂**](https://sourceforge.net/projects/ebf-class/)的软件，可以下载来看看）
- 正点原子官网：http://www.openedv.com/ 

> 里面会有**资料下载**的，可以把他们的资料都下下来看看，（有点大）
>
> 当然，我们也会提供资料的，到时候过来实验室"领取"



### 看视频

详细，但长： https://www.bilibili.com/video/BV1yW411Y7Gw     

简短，没那么详细：https://www.bilibili.com/video/BV1kx411k7JT

> B站等一些学习网站都会有很多类似的视频，多找找看，看哪个适合你



### 看书

有正点原子和野火的书这仅做**参考**，主要还是看stm官方的**数据手册**和**参考手册**

所以东西都要向官方（原版，不要翻译的）看齐，（虽然官方也可以有错）



### 看例程

可以参考网上的例程，不过大多数还是正点原子和野火，例程都在它们的官网上可以下载到

- 看例程主要是学习别人的编程思想、思路、代码等，只是做一个**参考**



### 上网找资料

网上一堆相关的资料，**对点**寻找资料，我哪个东西不会，就针对这个东西去上网搜索相关的资料，然后把这方面的知识点搞懂



### 问师兄师姐

是实在是搞不懂的情况下，还是建议先自己找资料，寻找问题的答案，最后再来问

- 不要一些简单的问题就来问，先经过自己的思考，最后实在想不明白了，可以说出来，没关系的，最主要的是要学会怎么**解决问题**



### 小组之间的交流

学习组间，找到和你一起学习的人，一起学习进步



### :star:看手册

这个其实比较难，刚开始可能也很难看下去，如果刚开始就叫你去啃数据手册的话，肯定会劝退一堆人，但是数据手册是最官方的，对你们之后的学习最有帮助的，当然也是学习周期最长的

我的建议是，刚开始是结合着来学习，上面所有的都试试，手册也肯定是要看（比如《STM32的用户手册》，《STM32固件库使用手册》等文档），在看视频的时候也会有教你们怎么看手册的，在学习的过程中，去学习如何看手册



## 最后的话

**最后，一定要多自己打代码，就当练字也行，多打代码，多实战，停留在理论的没用的**





------

------

------





# 什么是单片机



## 单片机基础概念

- [什么是单片机，它是如何工作的？](https://www.bilibili.com/video/BV1NT4y1j79q?from=search&seid=3212317522913684713&spm_id_from=333.337.0.0)

- [单片机基础概念](https://mp.weixin.qq.com/s/3EkN4WwJvvnBu-czOuuTDQ)



## 什么是stm32

STM32，从字面上来理解，ST 是意法半导体，M 是 Microelectronics 的缩写，32 表示 32 位，合起来理解，STM32 就是指 ST 公司开发的 32 位微控制器。

现在芯片涨得很快，stm32也因为价格太高了，慢慢的很多人再找国产芯片替代，比如GD32、AT32等等，不过学会stm32，再转向其他芯片学习是非常快的，毕竟stm32的学习资源很全，32位单片机都差不多



# 嵌入式C语言

这里插入讲一下，刚开始学stm32的时候可能会觉得这和自己所接触的C不太一样，嵌入式开发过程中常用的一些我整理了一下：

- [嵌入式 C语言 补充](https://blog.csdn.net/K_O_R_K/article/details/120579024?spm=1001.2014.3001.5501)

或者自己找其他的资料看看



# 环境配置



## 软件

### keil5-MDK

- [V5.3_1版本（稳定）](D:\stm32学习资料\keil5（V5.3版本）)
- [官网下载地址](https://www.keil.com/download/product/)
- :link:[网上安装链接](https://blog.csdn.net/dengjin20104042056/article/details/108057907)

> 几点比较重要：
>
> - 直接上官网下载安装包，安装就行了，然后打开注册机破解，破解方式百度
> - 记得安装软件包

#### 软件包

- [官网下载地址](https://www.keil.com/dd2/pack/)

#### stm32标准库

- [官网下载地址](https://www.st.com/zh/embedded-software/stm32-standard-peripheral-libraries.html)



### STM32cubeMX

- [CUBEMX官网下载连接](https://www.st.com/en/development-tools/stm32cubemx.html?sc=stm32cubemx)
- [JAVA环境](https://www.java.com/zh-CN/download/)
- :link:[网上安装教程](https://blog.csdn.net/Brendon_Tan/article/details/107685563)

#### java

#### :warning:JAVA选择旧一点的版本安装！！！不要更新！！！

> 版本选择安装：https://www.oracle.com/java/technologies/oracle-java-archive-downloads.html



CubeMX是基于Java开发的软件，所以需要先安装Java运行环境，下载地址在[这里](https://www.java.com/zh-CN/download/)

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20210822181941851.png" alt="image-20210822181941851" style="zoom: 67%;" />

#### CubeMX

- 下载地址： [官网下载地址](https://www.st.com/stm32cubemx)



安装 **cubemx** ，如果未安装 **Java** 环境，将会出现报错

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/20200728213848585.png" alt="3.2_0" style="zoom:80%;" />



安装完成后最后修改一下stm32HAL库的**安装位置**（默认是在C盘的）

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20210822182511755.png" alt="image-20210822182511755" style="zoom: 67%;" />

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20210822182533862.png" alt="image-20210822182533862" style="zoom: 67%;" />

最后就可以选择相应的型号**下载**了

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20210822182647062.png" alt="image-20210822182647062" style="zoom: 67%;" />



> 需要安装JAVA环境
>
> 是为**HAL库**开发做准备



## 驱动

### jlink驱动

- [官网下载连接](https://www.segger.com/downloads/jlink/)

- [本地](..\嵌入式\软件，环境配置\jlink\jlink.md)

> 驱动不用下那么新



### ch340驱动

- [下载连接](http://www.wch.cn/download/ch341ser_exe.html)



# 新建工程模板

- :link:[网上链接](https://blog.csdn.net/qq_43377410/article/details/113267042?ivk_sa=1024320u)

- 软件包：[下载地址](https://www.keil.com/dd2/pack/)
- stm32标准库：[下载地址](https://www.st.com/zh/embedded-software/stm32-standard-peripheral-libraries.html)



### 一些需要注意的地方

**头文件路径**

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-202111sdfh11214400634.png" alt="image-20211111214400634" style="zoom: 80%;" />

**编译器选项**

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-20211111dghk214515693.png" alt="image-20211111214515693" style="zoom: 80%;" />



**全局的宏定义**

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-202111sk11214541748.png" alt="image-20211111214541748" style="zoom:80%;" />



**输出文件**

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-2021ak1111214601644.png" alt="image-20211111214601644" style="zoom:80%;" />



**中文乱码问题**

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-2021asd1111214727880.png" alt="image-20211111214727880" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/image-2021111121akk4715191.png" alt="image-20211111214715191" style="zoom:80%;" />



# 点亮LED

我们学习一个开发板，一款芯片，最开始、也是最基础的一步就是“点亮LED”

虽然只是点灯，但可以检验你基本的配置，比如系统时钟配置，环境配置等等，这些最基础的东西有没有搞定



## 前置知识



### 什么是单片机的时钟

- :link:[网上链接 (对单片机中时钟的理解)](https://blog.csdn.net/qq_42384937/article/details/83512162)



### IO口模式

- :link:[网上链接](https://mp.weixin.qq.com/s/06y0uNoBFFFsz6VMm9E-xQ)
- :link:[开漏输出与推挽输出](https://zhuanlan.zhihu.com/p/41942876)





## 1. 寄存器





## 2. 标准固件库





## 3. HAL库





> 上面三种开发方式做对比，最好是都实现一遍亮点LED，（**野火**的视频都有讲解的）





## 下载方式

这里稍微介绍一下，代码的下载方式，ARM内核芯片下载程序方式可分为一下三类：

1. `ICP(In System Programing)`下载器下载（J-Link、ST-Link等）
2. `ISP(in-system programming)`下载，以stm32为例，可在不使用下载器而通过如UART、I2C、SPI、USB等通讯接口配合芯片启动代码（.s文件）进行升级
3. `IAP(In Application Programming)`下载，既编写应用软件实现程序升级，使用bootloader既属于此方法



### 使用jlink下载流程

#### 下载驱动

1、下载jlink驱动

​		上面有连接下载



#### 设置keil

2、选择jlink驱动

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/2019120821afag381927.png" alt="在这里插入图片描述" style="zoom: 80%;" />

3、选择SW接口下载

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/201912082138asdgg5458.jpg" alt="在这里插入图片描述" style="zoom:80%;" />

4、配置好相应的Flash Download选项

<img src="https://raw.githubusercontent.com/Nepqiu/gallery/master/img/2019120821393sdf7617.jpg" alt="在这里插入图片描述" style="zoom:80%;" />

#### 接线

5、 与单片机连接

如果使用这种JTAG口的，使用SWD下载的话就这样（如下图），一般会有转接板的，使用转接板更方便

<img src="https://img-blog.csdnimg.cn/20201121192148747.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl8zODA3NTg5NA==,size_16,color_FFFFFF,t_70" alt="img" style="zoom:67%;" />

如果使用普通的话

| 单片机 | 下载器 |
| ------ | ------ |
| 3.3V   | 3.3V   |
| GND    | GND    |
| SWDIO  | SWDIO  |
| SWCLK  | SWCLK  |

单片机上面会有**丝印**的

<img src="D:\Typora\image\image-20211111204652126.png" alt="image-20211111204652126" style="zoom:10%;" />



# 作业

1. 单片机是什么？说一下你对stm32的理解
2. stm32有几种开发方式？各有什么优缺点？
3. 新建工程模板检查
4. 点亮一个LED，实现一秒闪烁一次（一秒亮、一秒灭）
5. 学会简单的debug
6. **学习笔记**



> 下周检查，做评分，计入第二轮考核分数



# 最后

> 单片机本身没啥好折腾的，重点还是软件架构，针对项目设计软件，深度研究一种单片机。其他单片机都大同小异，大多数菜鸟都把时间荒废在单片机本身应用上，然后会几个外设就说很简单，都认为很简单，但是大部分都是半瓶水。
>
> 要知道，很多时候C语言、单片机stm32这些都是工具，主要还是应用，看你能不能把这个工具用好















